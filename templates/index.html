<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sentiment Analysis Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <!-- ğŸŒ— Modern Animated Toggle Switch -->
  <div class="theme-toggle">
    <button id="themeButton" class="theme-btn" aria-label="Toggle theme">
      ğŸŒ Light Mode
    </button>
  </div>

  <main class="container" role="main">
    <header class="hero">
      <h1>ğŸ§  <span>Sentiment Analysis</span></h1>
      <p class="subtitle">
        Compare <strong>VADER</strong> and <strong>RoBERTa</strong> sentiment models
      </p>
    </header>

    <form action="/predict" method="POST" class="form-box" aria-label="Sentiment input">
      <textarea name="text" placeholder="Enter text to analyze..." aria-label="Text to analyze">{{ original or '' }}</textarea>
      <div class="form-actions">
        <button type="submit" class="primary-btn">Analyze</button>
      </div>
    </form>

    {% if cleaned %}
    <section class="result-section" aria-live="polite">
      <h3>ğŸ§¹ Cleaned Text:</h3>
      <div class="cleaned-text">{{ cleaned }}</div>

      <h3>ğŸ“Š Predictions:</h3>

      <!-- VADER -->
      <article class="result-card">
        <h4>VADER Result:
          <span class="highlight">{{ vader_label|capitalize }}</span>
          {% if vader_label == 'positive' %} ğŸ˜Š {% elif vader_label == 'negative' %} ğŸ˜ {% else %} ğŸ˜ {% endif %}
        </h4>
        <div class="bar-group">
          <div class="bar positive" style="width: {{ vader_scores.positive * 100 }}%">
            Positive: {{ "%.3f"|format(vader_scores.positive) }}
          </div>
          <div class="bar neutral" style="width: {{ vader_scores.neutral * 100 }}%">
            Neutral: {{ "%.3f"|format(vader_scores.neutral) }}
          </div>
          <div class="bar negative" style="width: {{ vader_scores.negative * 100 }}%">
            Negative: {{ "%.3f"|format(vader_scores.negative) }}
          </div>
        </div>
      </article>

      <!-- RoBERTa -->
      <article class="result-card">
        <h4>RoBERTa Result:
          <span class="highlight">{{ roberta_label|capitalize }}</span>
          {% if roberta_label == 'positive' %} ğŸ˜Š {% elif roberta_label == 'negative' %} ğŸ˜ {% else %} ğŸ˜ {% endif %}
        </h4>
        <div class="bar-group">
          <div class="bar positive" style="width: {{ roberta_scores.positive * 100 }}%">
            Positive: {{ "%.3f"|format(roberta_scores.positive) }}
          </div>
          <div class="bar neutral" style="width: {{ roberta_scores.neutral * 100 }}%">
            Neutral: {{ "%.3f"|format(roberta_scores.neutral) }}
          </div>
          <div class="bar negative" style="width: {{ roberta_scores.negative * 100 }}%">
            Negative: {{ "%.3f"|format(roberta_scores.negative) }}
          </div>
        </div>
      </article>
    </section>
    {% endif %}

    {% if metrics %}
    <section class="chart-section">
      <h3 class="chart-title">ğŸ“ˆ Model Comparison (Sample 100 Tweets)</h3>
      <canvas id="metricsChart" width="600" height="320"></canvas>
    </section>
    {% endif %}

    <footer class="app-footer">Made with â¤ï¸ using Flask, VADER & RoBERTa</footer>
  </main>

  {% if metrics %}
  <script>
    const ctx = document.getElementById("metricsChart")?.getContext("2d");
    let chartTheme = localStorage.getItem("theme") === "dark";
    const chartColors = (dark) => ({
      text: dark ? "#e0e7ff" : "#0f172a",
      grid: dark ? "rgba(255,255,255,0.1)" : "rgba(0,0,0,0.1)",
      vader: dark ? "rgba(100,180,255,0.9)" : "rgba(54,162,235,0.8)",
      roberta: dark ? "rgba(255,140,160,0.9)" : "rgba(255,99,132,0.8)",
    });
    let chart;
    if (ctx) {
      const c = chartColors(chartTheme);
      chart = new Chart(ctx, {
        type: "bar",
        data: {
          labels: ["Accuracy", "Precision", "Recall", "F1 Score"],
          datasets: [
            {
              label: "VADER",
              data: [{{ metrics.vader.accuracy }}, {{ metrics.vader.precision }}, {{ metrics.vader.recall }}, {{ metrics.vader.f1 }}],
              backgroundColor: c.vader,
              borderRadius: 8,
            },
            {
              label: "RoBERTa",
              data: [{{ metrics.roberta.accuracy }}, {{ metrics.roberta.precision }}, {{ metrics.roberta.recall }}, {{ metrics.roberta.f1 }}],
              backgroundColor: c.roberta,
              borderRadius: 8,
            },
          ],
        },
        options: {
          animation: { duration: 1200 },
          scales: {
            y: { beginAtZero: true, max: 1, ticks: { color: c.text }, grid: { color: c.grid } },
            x: { ticks: { color: c.text }, grid: { display: false } },
          },
          plugins: { legend: { labels: { color: c.text } } },
        },
      });
    }
  </script>
  {% endif %}

  <!-- ğŸŒ— Theme Toggle Script -->
  <script>
    const themeButton = document.getElementById("themeButton");
    const body = document.body;

    function setTheme(isDark) {
      if (isDark) {
        body.classList.add("dark-mode");
        themeButton.textContent = "ğŸŒ™ Dark Mode";
        localStorage.setItem("theme", "dark");
      } else {
        body.classList.remove("dark-mode");
        themeButton.textContent = "ğŸŒ Light Mode";
        localStorage.setItem("theme", "light");
      }

      if (typeof chart !== "undefined" && chart) {
        const colors = {
          text: isDark ? "#e0e7ff" : "#0f172a",
          grid: isDark ? "rgba(255,255,255,0.1)" : "rgba(0,0,0,0.1)",
          vader: isDark ? "rgba(100,180,255,0.9)" : "rgba(54,162,235,0.8)",
          roberta: isDark ? "rgba(255,140,160,0.9)" : "rgba(255,99,132,0.8)",
        };
        chart.options.scales.x.ticks.color = colors.text;
        chart.options.scales.y.ticks.color = colors.text;
        chart.options.scales.y.grid.color = colors.grid;
        chart.data.datasets[0].backgroundColor = colors.vader;
        chart.data.datasets[1].backgroundColor = colors.roberta;
        chart.options.plugins.legend.labels.color = colors.text;
        chart.update();
      }
    }

    // Initialize theme from local storage
    const savedTheme = localStorage.getItem("theme");
    const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
    setTheme(savedTheme === "dark" || (savedTheme === null && prefersDark));

    themeButton.addEventListener("click", () => {
      const darkNow = body.classList.contains("dark-mode");
      setTheme(!darkNow);
    });

    // Animate bars
    window.addEventListener("load", () => {
      document.querySelectorAll(".bar").forEach((bar, i) => {
        const m = bar.getAttribute("style")?.match(/width:\s*([\d.]+)%/);
        const pct = m ? Math.max(parseFloat(m[1]), 4) : 4;
        bar.style.width = "0%";
        setTimeout(() => {
          bar.classList.add("visible");
          bar.style.width = pct + "%";
        }, 250 + i * 100);
      });
    });
  </script>
</body>
</html>
